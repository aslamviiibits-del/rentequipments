<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GearHire+ — Rentals & Experts</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  :root{--brand:#0ea5e9;--ink:#0f172a;--border:#e5e7eb;}
  body{background:#f8fafc;color:var(--ink);}
  .navbar{background:#fff;border-bottom:1px solid var(--border);}
  .btn-brand{background:var(--brand);color:#fff;border:none}
  .btn-brand:hover{background:#0284c7;color:#fff}
  .card{border-radius:14px;border:1px solid var(--border)}
  .img-fit{height:150px;object-fit:cover;border-top-left-radius:14px;border-top-right-radius:14px}
  .chipbar{position:sticky;top:56px;background:#f8fafc;padding:.5rem;border-bottom:1px dashed var(--border);z-index:2}
  .chip-scroll{display:flex;overflow:auto;gap:.5rem}
  .chip{border:1px solid var(--border);border-radius:999px;padding:.4rem .7rem;background:#fff;font-size:.9rem;white-space:nowrap}
  .chip.active{background:var(--brand);color:#fff;border-color:var(--brand)}
  .sticky-bar{position:sticky;bottom:0;background:#fff;border-top:1px solid var(--border);padding:.6rem;z-index:10}
  .empty{border:2px dashed var(--border);border-radius:12px;padding:2rem;text-align:center;color:#6b7280}
</style>
</head>
<body>

<nav class="navbar">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="#">GearHire+</a>
    <button id="adminBtn" class="btn btn-brand">Admin</button>
  </div>
</nav>

<!-- Quick chips -->
<div class="chipbar">
  <div class="chip-scroll" id="chipScroll">
    <button class="chip active" data-cat="">All</button>
    <button class="chip" data-cat="Camera">Camera</button>
    <button class="chip" data-cat="Audio">Audio</button>
    <button class="chip" data-cat="Lighting">Lighting</button>
    <button class="chip" data-cat="Construction">Construction</button>
    <button class="chip" data-cat="Medical">Medical</button>
  </div>
</div>

<!-- Search -->
<div class="container-fluid mt-2 px-3">
  <input id="searchInput" class="form-control" placeholder="Search equipment…" />
</div>

<!-- Catalog -->
<div class="container-fluid my-3 px-3">
  <div id="catalog" class="row g-3"></div>
  <div id="empty" class="empty d-none">No equipment found</div>
</div>

<!-- Sticky summary -->
<div class="sticky-bar">
  <div class="container-fluid d-flex justify-content-between">
    <div id="summaryText" class="text-muted small">Pick an item to start booking.</div>
    <button id="resetBtn" class="btn btn-outline-secondary btn-sm">Reset</button>
  </div>
</div>

<!-- Booking Modal -->
<div class="modal fade" id="bookingModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
    <div class="modal-content">
      <form id="bookingForm">
        <div class="modal-header">
          <h5 id="modalTitle" class="modal-title">Book</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <h6 id="equipName"></h6>
          <div class="small text-muted">₹<span id="equipRate">0</span>/day · Expert ₹<span id="expertRate">0</span>/day</div>
          <hr>
          <div class="row g-2">
            <div class="col-6"><input type="date" id="startDate" class="form-control" required></div>
            <div class="col-3"><input type="number" id="days" class="form-control" min="1" value="1" required></div>
            <div class="col-3"><input type="number" id="qty" class="form-control" min="1" value="1" required></div>
            <div class="col-12">
              <select id="mode" class="form-select">
                <option value="equipment">Just Equipment</option>
                <option value="expert">With Expert</option>
              </select>
            </div>
            <div class="col-12"><input id="custLocation" class="form-control" placeholder="City / Pincode" required></div>
            <div class="col-12"><input id="custName" class="form-control" placeholder="Your name" required></div>
            <div class="col-12"><input id="custPhone" class="form-control" placeholder="Phone / WhatsApp" required></div>
            <div class="col-12"><textarea id="notes" class="form-control" placeholder="Notes"></textarea></div>
          </div>
          <hr>
          <div class="d-flex justify-content-between">
            <div class="small">
              Equipment: ₹<span id="equipTotal">0</span><br>
              Expert: ₹<span id="expertTotal">0</span>
            </div>
            <div class="text-end">
              <div class="text-muted small">Grand total</div>
              <div class="fs-4 fw-bold">₹<span id="grandTotal">0</span></div>
            </div>
          </div>
        </div>
        <div class="modal-footer d-grid gap-2">
          <button type="button" id="waBtn" class="btn btn-success">WhatsApp Order</button>
          <button type="submit" class="btn btn-outline-secondary">Confirm (Pay Later)</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Admin Modal -->
<div class="modal fade" id="adminModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <form id="adminForm">
        <div class="modal-header">
          <h5 class="modal-title">Inventory Admin</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row g-2">
            <div class="col-12"><input id="a_name" class="form-control" placeholder="Name" required></div>
            <div class="col-6"><input id="a_cat" class="form-control" placeholder="Category"></div>
            <div class="col-6"><input id="a_img" class="form-control" placeholder="Image URL"></div>
            <div class="col-4"><input id="a_rate" type="number" class="form-control" placeholder="₹/day"></div>
            <div class="col-4"><input id="a_expert" type="number" class="form-control" placeholder="Expert ₹"></div>
            <div class="col-4"><input id="a_qty" type="number" class="form-control" placeholder="Qty"></div>
            <div class="col-12"><textarea id="a_blackout" class="form-control" placeholder="Blackout dates (YYYY-MM-DD,…)"></textarea></div>
          </div>
          <hr>
          <h6>Inventory</h6>
          <ul id="invList" class="list-group small"></ul>
        </div>
        <div class="modal-footer">
          <button id="exportJson" class="btn btn-outline-secondary" type="button">Export JSON</button>
          <button id="exportCsv" class="btn btn-outline-success" type="button">Export CSV</button>
          <button id="exportBookings" class="btn btn-outline-dark" type="button">Export Bookings</button>
          <label class="btn btn-outline-primary mb-0">
            Import JSON <input id="importJson" type="file" accept="application/json" hidden>
          </label>
          <button id="clearStore" class="btn btn-outline-danger" type="button">Clear All</button>
        </div>
      </form>
    </div>
  </div>
</div>

<template id="cardTpl">
  <div class="col-12 col-sm-6 col-lg-4">
    <div class="card h-100">
      <img class="img-fit" alt="">
      <div class="card-body d-flex flex-column">
        <h6 class="card-title"></h6>
        <p class="text-muted small"></p>
        <div class="fw-bold">₹<span class="rate"></span>/day</div>
        <div class="text-muted small">Expert ₹<span class="expert"></span>/day</div>
        <div class="mt-auto d-grid gap-2">
          <button class="btn btn-outline-secondary btn-sm btn-eq">Just Equipment</button>
          <button class="btn btn-brand btn-sm btn-ex">With Expert</button>
        </div>
      </div>
    </div>
  </div>
</template>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
// WhatsApp number
const WHATSAPP='918970100123';

// Save/load catalog
function saveCatalog(){ localStorage.setItem('catalogData', JSON.stringify(CATALOG)); }
function loadCatalog(){ const d=localStorage.getItem('catalogData'); return d?JSON.parse(d):null; }

// Initial catalog
let CATALOG=loadCatalog()||[
  {id:'cam',name:'Sony A7 IV',category:'Camera',desc:'33MP full-frame',rate:2500,expertRate:1800,img:'https://images.unsplash.com/photo-1516035069371-29a1b244cc32?q=80',qty:2,blackout:['2025-09-22']},
  {id:'mic',name:'Shure SM7B',category:'Audio',desc:'Podcast mic',rate:600,expertRate:800,img:'https://images.unsplash.com/photo-1643561168149-c87b14f3abd7?q=80&w=1332&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',qty:3,blackout:[]},
 {id:'light-120d',name:'Aputure 120d II Light Kit',category:'Lighting',desc:'LED + softbox for film shoots',rate:900,expertRate:1000,img:'https://plus.unsplash.com/premium_photo-1710736885792-ab9acded6041?q=80&w=1332&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',qty:2,blackout:['2025-09-20']},
  {id:'drill-pro',name:'Bosch Rotary Hammer Drill',category:'Construction',desc:'Heavy-duty SDS drill for concrete',rate:500,expertRate:700,img:'https://images.unsplash.com/photo-1748273784058-57eade4322d6?q=80&w=687&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',qty:5,blackout:[]},
  {id:'tripod-manf',name:'Manfrotto Tripod 055',category:'Camera',desc:'Sturdy tripod for DSLR & cinema cams',rate:300,expertRate:0,img:'https://images.unsplash.com/photo-1730182670365-327e319f92da?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',qty:4,blackout:[]},
  {id:'lens-canon',name:'Canon RF 70-200mm Lens',category:'Camera',desc:'Telephoto zoom lens',rate:1200,expertRate:1000,img:'https://images.unsplash.com/photo-1617036083087-ce31fac66b23?q=80&w=687&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',qty:3,blackout:[]},
  {id:'rec-zoom',name:'Zoom H6 Recorder',category:'Audio',desc:'Portable field recorder, 6 inputs',rate:800,expertRate:500,img:'https://images.unsplash.com/photo-1611785156827-9e04be33ad73?q=80&w=687&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',qty:2,blackout:[]},
  {id:'speaker-jbl',name:'JBL EON610 PA Speaker',category:'Audio',desc:'10-inch powered loudspeaker',rate:1000,expertRate:600,img:'https://images.unsplash.com/photo-1672430786413-cd3d54aea5b0?q=80&w=735&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',qty:6,blackout:[]},
  {id:'light-godox',name:'Godox SL60W LED Light',category:'Lighting',desc:'Affordable studio LED',rate:400,expertRate:300,img:'https://plus.unsplash.com/premium_photo-1741732496551-31931df59365?q=80&w=687&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',qty:5,blackout:[]},
  {id:'scaff-set',name:'Aluminium Scaffolding Set',category:'Construction',desc:'Safe scaffolding for high work',rate:1500,expertRate:2000,img:'https://images.unsplash.com/photo-1627805460755-0f4a9a90c5f4?q=80&w=735&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',qty:2,blackout:[]},
  {id:'med-vent',name:'Portable Ventilator',category:'Medical',desc:'Emergency-use portable ventilator',rate:3000,expertRate:2500,img:'https://media.istockphoto.com/id/2190660332/photo/cpap-machine-and-mask-on-white-surface-for-sleep-apnea-therapy.jpg?s=1024x1024&w=is&k=20&c=IKwkQSfz2EYW7daMzoXc1ykks90SvePI38inw97rSYM=',qty:1,blackout:[]},
  {id:'med-oxym',name:'Pulse Oximeter Kit',category:'Medical',desc:'SpO2 measurement kit for hospitals',rate:200,expertRate:100,img:'https://images.unsplash.com/photo-1665152444454-7ce72e64390f?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',qty:10,blackout:[]}
];

// DOM refs
const catalogEl=document.getElementById('catalog'),emptyEl=document.getElementById('empty');
const searchInput=document.getElementById('searchInput'),summaryText=document.getElementById('summaryText'),resetBtn=document.getElementById('resetBtn'),chipScroll=document.getElementById('chipScroll');
const bookingModal=new bootstrap.Modal('#bookingModal');
const equipName=document.getElementById('equipName'),equipRate=document.getElementById('equipRate'),expertRate=document.getElementById('expertRate');
const startDate=document.getElementById('startDate'),days=document.getElementById('days'),qty=document.getElementById('qty'),mode=document.getElementById('mode');
const custLocation=document.getElementById('custLocation'),custName=document.getElementById('custName'),custPhone=document.getElementById('custPhone'),notes=document.getElementById('notes');
const equipTotal=document.getElementById('equipTotal'),expertTotal=document.getElementById('expertTotal'),grandTotal=document.getElementById('grandTotal');
const waBtn=document.getElementById('waBtn'),bookingForm=document.getElementById('bookingForm');
let currentItem=null;

// Render catalog
function renderCatalog(list){
  catalogEl.innerHTML='';
  const tpl=document.getElementById('cardTpl');
  list.forEach(it=>{
    const node=tpl.content.cloneNode(true);
    node.querySelector('.card-title').textContent=it.name;
    node.querySelector('.text-muted').textContent=it.desc;
    node.querySelector('.rate').textContent=it.rate;
    node.querySelector('.expert').textContent=it.expertRate;
    node.querySelector('img').src=it.img;
    node.querySelector('.btn-eq').onclick=()=>openBooking(it,'equipment');
    node.querySelector('.btn-ex').onclick=()=>openBooking(it,'expert');
    catalogEl.appendChild(node);
  });
  emptyEl.classList.toggle('d-none',list.length>0);
  summaryText.textContent=`Showing ${list.length} item(s)`;
}

// Apply filters
function applyFilters(){
  const q=searchInput.value.toLowerCase();
  const cat=chipScroll.querySelector('.chip.active').dataset.cat;
  const list=CATALOG.filter(it=>(!cat||it.category===cat)&&(!q||it.name.toLowerCase().includes(q)));
  renderCatalog(list);
}

// Booking
function openBooking(item,modeSel){
  currentItem=item;
  equipName.textContent=item.name;
  equipRate.textContent=item.rate;
  expertRate.textContent=item.expertRate;
  startDate.value=new Date().toISOString().slice(0,10);
  days.value=1;qty.value=1;mode.value=modeSel;
  custLocation.value='';custName.value=custPhone.value=notes.value='';
  recalcTotals();bookingModal.show();
}
function recalcTotals(){
  const d=+days.value||1,q=+qty.value||1;
  const eq=currentItem.rate*d*q,ex=(mode.value==='expert'?currentItem.expertRate*d*q:0);
  equipTotal.textContent=eq;expertTotal.textContent=ex;grandTotal.textContent=eq+ex;
  const payload=`Rental Inquiry: ${currentItem.name}\nMode: ${mode.value}\nStart:${startDate.value} Days:${d} Qty:${q}\nTotal:₹${eq+ex}`;
  waBtn.onclick=()=>window.open(`https://wa.me/${WHATSAPP}?text=${encodeURIComponent(payload)}`,'_blank');
}
[startDate,days,qty,mode,custLocation,custName,custPhone,notes].forEach(el=>el.addEventListener('input',recalcTotals));
bookingForm.onsubmit=e=>{
  e.preventDefault();bookingModal.hide();alert('Booking saved!');
  // Save booking log
  let logs=JSON.parse(localStorage.getItem('bookingLogs')||"[]");
  logs.push({item:currentItem.name,mode:mode.value,start:startDate.value,days:days.value,qty:qty.value,customer:custName.value,phone:custPhone.value,location:custLocation.value,notes:notes.value,total:grandTotal.textContent,timestamp:new Date().toISOString()});
  localStorage.setItem('bookingLogs',JSON.stringify(logs));
};

// Chips
chipScroll.onclick=e=>{
  const btn=e.target.closest('.chip');if(!btn)return;
  chipScroll.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  btn.classList.add('active');applyFilters();
};
searchInput.oninput=applyFilters;
resetBtn.onclick=()=>{searchInput.value='';chipScroll.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));chipScroll.querySelector('.chip[data-cat=""]').classList.add('active');applyFilters();};
applyFilters();

// --- Admin Panel ---
const adminBtn=document.getElementById('adminBtn');
const adminModal=new bootstrap.Modal('#adminModal');
const adminForm=document.getElementById('adminForm');
const invList=document.getElementById('invList');
adminBtn.onclick=()=>{adminModal.show();renderInventory();};
function renderInventory(){
  invList.innerHTML='';
  CATALOG.forEach((it,i)=>{
    const li=document.createElement('li');
    li.className='list-group-item d-flex justify-content-between align-items-center';
    li.innerHTML=`<span><b>${it.name}</b> <small class="text-muted">(${it.category})</small></span>
      <button class="btn btn-sm btn-outline-danger" data-i="${i}">Delete</button>`;
    invList.appendChild(li);
  });
}
adminForm.onsubmit=e=>{
  e.preventDefault();
  const name=document.getElementById('a_name').value,cat=document.getElementById('a_cat').value,img=document.getElementById('a_img').value;
  const rate=+document.getElementById('a_rate').value||0,expert=+document.getElementById('a_expert').value||0,qty=+document.getElementById('a_qty').value||1;
  const blackout=document.getElementById('a_blackout').value.split(',').map(s=>s.trim()).filter(Boolean);
  CATALOG.push({id:name.toLowerCase().replace(/\s+/g,'-'),name,category:cat,desc:'',rate,expertRate:expert,img,qty,blackout});
  saveCatalog();adminForm.reset();renderInventory();applyFilters();
};
invList.onclick=e=>{
  if(e.target.tagName==='BUTTON'){const idx=+e.target.dataset.i;CATALOG.splice(idx,1);saveCatalog();renderInventory();applyFilters();}
};

// Export/Import
document.getElementById('exportJson').onclick=()=>{
  const blob=new Blob([JSON.stringify(CATALOG,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='catalog.json';a.click();URL.revokeObjectURL(url);
};
document.getElementById('exportCsv').onclick=()=>{
  if(!CATALOG.length){alert('Catalog empty');return;}
  const headers=["ID","Name","Category","Description","Rate","ExpertRate","Qty","BlackoutDates","Image"];
  const rows=CATALOG.map(it=>[it.id,it.name,it.category,it.desc||'',it.rate,it.expertRate,it.qty,(it.blackout||[]).join(';'),it.img||'']);
  const csv=[headers.join(","),...rows.map(r=>r.map(f=>`"${f}"`).join(","))].join("\n");
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='catalog.csv';a.click();URL.revokeObjectURL(url);
};
document.getElementById('importJson').onchange=e=>{
  const file=e.target.files[0];if(!file)return;const reader=new FileReader();
  reader.onload=ev=>{try{const data=JSON.parse(ev.target.result);if(Array.isArray(data)){CATALOG=data;saveCatalog();renderInventory();applyFilters();alert('Catalog imported');}else alert('Invalid JSON');}catch(err){alert('Error: '+err.message);}};
  reader.readAsText(file);
};
document.getElementById('clearStore').onclick=()=>{if(confirm('Clear catalog?')){localStorage.removeItem('catalogData');location.reload();}};
document.getElementById('exportBookings').onclick=()=>{
  const logs=JSON.parse(localStorage.getItem('bookingLogs')||"[]");if(!logs.length){alert('No bookings');return;}
  const headers=["Item","Mode","StartDate","Days","Qty","Customer","Phone","Location","Notes","Total","Timestamp"];
  const rows=logs.map(l=>[l.item,l.mode,l.start,l.days,l.qty,l.customer,l.phone,l.location,l.notes||'',l.total,l.timestamp]);
  const csv=[headers.join(","),...rows.map(r=>r.map(f=>`"${f}"`).join(","))].join("\n");
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='bookings.csv';a.click();URL.revokeObjectURL(url);
};
</script>
</body>
</html>
